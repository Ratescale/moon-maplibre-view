<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>ğŸŒœMoon ViewerğŸŒ›</title>
		<meta
			name="viewport"
			content="initial-scale=1,maximum-scale=1,user-scalable=no"
		/>
		<!-- MapLibreã®æœ¬ä½“JSã¨CSSã‚’èª­ã¿è¾¼ã‚€ -->
		<script src="https://unpkg.com/maplibre-gl@5.0.0-pre.10/dist/maplibre-gl.js"></script>
		<link
			href="https://unpkg.com/maplibre-gl@5.0.0-pre.10/dist/maplibre-gl.css"
			rel="stylesheet"
		/>
		<style>
			body {
				margin: 0;
				padding: 0;
				background-color: #222;
			}
			#map {
				position: absolute;
				top: 0;
				bottom: 0;
				width: 100%;
			}
		</style>
	</head>
	<body>
		<!-- åœ°å›³ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã®divè¦ç´  -->
		<div id="map"></div>

		<script>
			// ã“ã“ã‹ã‚‰ãŒMapLibre GL JSã§æœˆé¢ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã®ã‚³ãƒ¼ãƒ‰
			const map = new maplibregl.Map({
				container: 'map',          // ãƒãƒƒãƒ—ã‚’è¡¨ç¤ºã™ã‚‹HTMLè¦ç´ ã®ID
				zoom: 2,                   // åˆæœŸã‚ºãƒ¼ãƒ ãƒ¬ãƒ™ãƒ«
				renderWorldCopies: false,  // åœ°çƒè¡¨ç¾ã®å ´åˆã¯ä¸–ç•Œã‚’ç¹°ã‚Šè¿”ã—è¡¨ç¤ºã™ã‚‹ãŒã€æœˆãªã®ã§ã‚ªãƒ•
				projection: 'globe',       // åœ°å›³ã®æŠ•å½±æ–¹æ³•ã¨ã—ã¦ 'globe' ã‚’ä½¿ç”¨(3Dã£ã½ã„åœ°çƒå„€è¡¨ç¾)
				style: {
					version: 8,
					glyphs: 'mapbox://fonts/mapbox/{fontstack}/{range}.pbf',
					sources: {
						// 1) æœˆé¢è¡¨é¢ç”»åƒ(LROC)ã®ã‚¿ã‚¤ãƒ«ã‚½ãƒ¼ã‚¹
						surface: {
							type: 'raster',
							tiles: [
								'https://tiles.spatialty.io/moon_surface/{z}/{x}/{y}.png',
							],
							tileSize: 256,
							maxzoom: 7,
							attribution:
								'USGS/NASA: <a href="https://astrogeology.usgs.gov/search/map/Moon/LRO/LROC_WAC/Lunar_LRO_LROC-WAC_Mosaic_global_100m_June2013">Surface</a> | <a href="https://planetarynames.wr.usgs.gov/Page/MOON/target">Crater</a> | <a href="https://pgda.gsfc.nasa.gov/products/54">DEM</a>',
						},
						// 2) DEM ã‚¿ã‚¤ãƒ«(raster-dem)ã§æ¨™é«˜ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€ã‚½ãƒ¼ã‚¹
						terrain: {
							type: 'raster-dem',
							tiles: [
								'https://tiles.spatialty.io/moon_terrain/{z}/{x}/{y}.png',
							],
							tileSize: 512,
							maxzoom: 8,
							bounds: [-180, -60, 180, 60], // DEMãŒã‚«ãƒãƒ¼ã™ã‚‹ç¯„å›²(ç·¯åº¦çµŒåº¦)
						},
						// Hillshadeç”¨ã«ã‚‚ã†ã²ã¨ã¤rasterã¨ã—ã¦èª­ã‚“ã§ã„ã‚‹ã‚½ãƒ¼ã‚¹(terrain2)
						terrain2: {
							type: 'raster',
							tiles: [
								'https://tiles.spatialty.io/moon_terrain/{z}/{x}/{y}.png',
							],
							tileSize: 512,
							maxzoom: 8,
							bounds: [-180, -60, 180, 60],
						},
						// 3) ã‚¯ãƒ¬ãƒ¼ã‚¿ãƒ¼å(GeoJSON)
						crater: {
							type: 'geojson',
							data: './cratername.geojson',
						},
					},
					layers: [
						// æœˆé¢è¡¨é¢ç”»åƒã®ãƒ¬ã‚¤ãƒ¤ãƒ¼
						{
							id: 'surface',
							type: 'raster',
							source: 'surface',
							paint: {
								'raster-fade-duration': 0,
							},
						},
						// å°ã•ã‚ã®ã‚¯ãƒ¬ãƒ¼ã‚¿ãƒ¼åã®ãƒ©ãƒ™ãƒ«(ã‚ºãƒ¼ãƒ 5ä»¥ä¸Šã§è¡¨ç¤º)
						{
							id: 'crater',
							type: 'symbol',
							source: 'crater',
							layout: {
								'text-field': ['get', 'name'],        // ã‚¯ãƒ¬ãƒ¼ã‚¿ãƒ¼åã‚’è¡¨ç¤º
								'text-font': ['Metropolis Bold'],
								'text-size': 15,
							},
							paint: {
								'text-color': 'white',
								'text-halo-color': 'black',
								'text-halo-width': 1,
							},
							minzoom: 5,
						},
						// ä¸­ãã‚‰ã„ã®ã‚µã‚¤ã‚º(>100km)ã®ã‚¯ãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚’æ‹¡å¤§è¡¨ç¤º(ã‚ºãƒ¼ãƒ 3.5ä»¥ä¸Š)
						{
							id: 'crater-mid',
							type: 'symbol',
							source: 'crater',
							layout: {
								'text-field': ['get', 'name'],
								'text-font': ['Metropolis Bold'],
								'text-size': 17,
							},
							paint: {
								'text-color': 'white',
								'text-halo-color': 'black',
								'text-halo-width': 1,
							},
							filter: ['>', ['get', 'diameter'], 100],
							minzoom: 3.5,
						},
						// å¤§ããªã‚¯ãƒ¬ãƒ¼ã‚¿ãƒ¼(>300km)ã¯ã•ã‚‰ã«å¤§ãã„æ–‡å­—ã§è¡¨ç¤º
						{
							id: 'crater-big',
							type: 'symbol',
							source: 'crater',
							layout: {
								'text-field': ['get', 'name'],
								'text-font': ['Metropolis Bold'],
								'text-size': 20,
							},
							paint: {
								'text-color': 'white',
								'text-halo-color': 'black',
								'text-halo-width': 1,
							},
							filter: ['>', ['get', 'diameter'], 300],
						},
					],
					// terrainãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ä½¿ã£ã¦3Dèµ·ä¼è¡¨ç¾ã‚’æœ‰åŠ¹åŒ–
					terrain: {
						source: 'terrain',        // raster-dem ã‚¿ã‚¤ãƒ«ã®ã‚½ãƒ¼ã‚¹
						exaggeration: 20,        // é«˜ã•ã®å¼·èª¿å€ç‡(20å€)
					},
				},
				maxPitch: 85, // ã‚«ãƒ¡ãƒ©ã®å‚¾æ–œè§’åº¦ã®ä¸Šé™
				maxZoom: 10,
			});

			// ãƒ„ãƒ¼ãƒ«ãƒãƒ¼(ã‚ºãƒ¼ãƒ ã‚¤ãƒ³ãƒ»ã‚ºãƒ¼ãƒ ã‚¢ã‚¦ãƒˆã€å›è»¢ãªã©)
			map.addControl(new maplibregl.NavigationControl());
			// å…¨ç”»é¢è¡¨ç¤ºãƒœã‚¿ãƒ³
			map.addControl(new maplibregl.FullscreenControl());
			// MapLibre ã®ãƒ­ã‚´ã‚’å·¦ä¸‹ã«é…ç½®
			map.addControl(new maplibregl.LogoControl(), 'bottom-left');

			// ãƒãƒƒãƒ—ãŒèª­ã¿è¾¼ã¾ã‚ŒãŸã¨ãã®ã‚¤ãƒ™ãƒ³ãƒˆ
			map.on('load', () => map.setProjection({ type: 'globe' }));
		</script>
	</body>
</html>